!function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function e(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}var o=0;function a(t){return"__private_"+o+++"_"+t}function l(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}function s(t,e,n){for(var r=3*(e/3|0),i=[],o=0;o<3;o++){if(!t[r+o].isOwnedBy(n))return!1;i.push(r+o)}return i}function c(t,e,n){for(var r=e%3,i=[],o=0;o<3;o++){if(!t[r+3*o].isOwnedBy(n))return!1;i.push(r+3*o)}return i}function u(t,e,n){return!(e%1)&&(h.apply(void 0,arguments)||f.apply(void 0,arguments))}function h(t,e,n){if(e%4==2)return!1;for(var r=[],i=0;i<3;i++){if(!t[4*i].isOwnedBy(n))return!1;r.push(4*i)}return r}function f(t,e,n){if(e%8==0)return!1;for(var r=[],i=1;i<4;i++){if(!t[2*i].isOwnedBy(n))return!1;r.push(2*i)}return r}function d(t,e,n){return c.apply(void 0,arguments)||s.apply(void 0,arguments)||u.apply(void 0,arguments)}function m(t,e){this.x=t||0,this.y=e||0}m.prototype={add:function(){for(var t,e=i([].slice.call(arguments));!(t=e()).done;){var n=t.value;this.x+=n.x,this.y+=n.y}},multiply:function(t){return"number"!=typeof t?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},divide:function(t){return"number"!=typeof t?(0!=t.x&&(this.x/=t.x),0!=t.y&&(this.y/=t.y)):0!=t&&(this.x/=t,this.y/=t),this},equals:function(t){return this.x==t.x&&this.y==t.y},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},get length(){return Math.sqrt(this.dot(this))},normalize:function(){return this.divide(this.length)},clone:function(){return new m(this.x,this.y)}},m.NUL=Object.freeze({x:0,y:0,clone:function(){return new m}});var y=function(t,e){try{return Promise.resolve(new Promise(function(n){var r,i=g(e);requestAnimationFrame(function o(a){for(var l=r||a;l<a;l++){var s=i.next(),c=s.value;if(s.done)return n(c);t.fillStyle=e.color,t.beginPath(),t.rect(c.x>>20,c.y>>20,e.thickness,1),t.fill()}requestAnimationFrame(o),r=a})}))}catch(t){return Promise.reject(t)}},p=regeneratorRuntime.mark(g),v=["#b3312c","#eb8844","#decf2a","#41cd34","#3b511a","#6689d3","#287697","#253192","#7b2fbe","#c354cd","#d88198","#f0f0f0","#ababab","#434343","#1e1b1b","#51301a"],b=new m(0,-.981);function g(t){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return e=t.initialAcceleration.clone(),n=t.initialVelocity.clone(),r=t.initialPosition.clone(),l.next=5,r;case 5:i=0;case 6:if(!(i<t.lifeExpectancy)){l.next=17;break}return o=i<t.fuelAutonomy?n.clone().normalize().multiply(t.motorThrust*(1-Math.exp(-i))):m.NUL,a=n.clone().multiply(-t.frictionCoefficient),e.add(b,o,a),n.add(e),r.add(n),l.next=14,r;case 14:i++,l.next=6;break;case 17:return l.abrupt("return",{position:r,velocity:n,acceleration:e});case 18:case"end":return l.stop()}},p)}function w(t,e,n){void 0===t&&(t=5),void 0===e&&(e=200),void 0===n&&(n=1);var r=1e3*n,i=1e3*n,o=document.createElement("canvas");o.height=i,o.width=r;var a=o.getContext("2d");return a.setTransform(n,0,0,-n,r/2,i),requestAnimationFrame(function(t,e,n){void 0===n&&(n=null);var r,i,o=t.width,a=t.height;return null==n&&(n=t.getContext("2d")),e.then(function(){t.addEventListener("transitionend",function(){cancelAnimationFrame(i),t.remove()}),t.style.transformOrigin="top",t.style.transition="all 3s ease-in",t.style.transitionProperty="opacity,transform",t.style.opacity=0,t.style.transform="scaleY(1.5)"}),function t(e){for(var l=n.getImageData(0,0,o,a),s=(e-r)/16,c=3;c<l.data.length;c+=4){var u=l.data[c];u>16&&(l.data[c]=u-(u>>3)*s)}n.putImageData(l,0,0),i=requestAnimationFrame(t),r=e}}(o,Promise.all(Array.from({length:t},function(t,n){return(r=50*Math.random()+n*e,new Promise(function(t){return setTimeout(t,r)})).then(function(){return function(t,e,n){void 0===e&&(e=m.NUL),void 0===n&&(n=void 0);var r={initialPosition:e,initialVelocity:m.NUL,initialAcceleration:new m((Math.random()+1.5)%2-1,-7*b.y),lifeExpectancy:900+300*Math.random(),fuelAutonomy:600,motorThrust:-5*b.y,frictionCoefficient:15e-6*Math.random()+5e-6,thickness:7,color:n||v[Math.random()*v.length|0]};return y(t,r).then(function(e){return Promise.all(Array.from({length:10*Math.random()},function(){return y(t,function(t,e){return{initialPosition:t.position,initialVelocity:new m(0,t.velocity.y),initialAcceleration:new m(2e3*(Math.random()-.5),1e3*-b.y),lifeExpectancy:800,fuelAutonomy:0,motorThrust:0,frictionCoefficient:15e-6*Math.random()+5e-6,thickness:3,color:e}}(e,r.color))}))}).catch(console.error)}(a)});var r})),a)),o}var E=new WeakMap;function x(t){E.get(t.target).makeMove()}var k=function(){function t(t,e){Object.defineProperty(this,A,{writable:!0,value:void 0}),Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:this.createHTMLElement()}),l(this,A)[A]=t,l(this,P)[P]=e}var n=t.prototype;return n.createHTMLElement=function(){var t=document.createElement("button");return t.addEventListener("click",x),t.className="cell",t.setAttribute("aria-label","Empty cell"),E.set(t,this),t},n.makeMove=function(){l(this,P)[P].makeMove(this)},n.isOwnedBy=function(t){return l(this,O)[O]===t},n.setFoot=function(t){l(this,O)[O]=t,this.htmlElement.removeAttribute("aria-label"),this.htmlElement.dataset.player=t.symbol},n.setWinningFlag=function(){this.htmlElement.classList.add("win")},n.isEmpty=function(){return!l(this,O)[O]},n.enable=function(){this.htmlElement.disabled=!1},n.disable=function(){this.htmlElement.disabled=!0},e(t,[{key:"htmlElement",get:function(){return l(this,M)[M]}},{key:"id",get:function(){return l(this,A)[A]}}]),t}(),A=a("id"),O=a("owner"),P=a("game"),M=a("htmlElement"),j=Boolean(Element.prototype.scrollIntoViewIfNeeded),F=function(t){var e,r;function o(e,r){var i,o;return o=t.call(this,e)||this,Object.defineProperty(n(o),L,{writable:!0,value:void 0}),l(n(o),L)[L]=Array.from({length:9},function(t,e){return new k(e,r)}),(i=o.htmlElement).append.apply(i,l(n(o),L)[L].map(function(t){return t.htmlElement})),o}r=t,(e=o).prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r;var a=o.prototype;return a.createHTMLElement=function(){var t=document.createElement("div");return t.className="tic-tac-toe",t},a.has=function(t){return l(this,L)[L].includes(t)},a.isLegal=function(t){return this.has(t)&&(t.isEmpty()||l(this,L)[L].every(function(t){return!t.isEmpty()}))},a.makeMove=function(t,e){if(!this.isLegal(e))throw new Error("Illegal move");e.isEmpty()&&(e.setFoot(t),this.checkForWinner(t,e))},a.checkForWinner=function(t,e){if(this.isEmpty()){var n=d(l(this,L)[L],e.id,t);if(n){for(var r,o=this.htmlElement.getBoundingClientRect(),a=w(9,200,o.height/1e3),s=i(n);!(r=s()).done;){var c=r.value;l(this,L)[L][c].setWinningFlag()}this.setFoot(t),a.style.top=o.top-o.height/6+"px",a.style.left=o.left+"px",document.body.append(a)}}},a.enable=function(){var t=l(this,L)[L].filter(function(t){return t.isEmpty()});(t.length?t:l(this,L)[L]).forEach(function(t){return t.enable()}),j&&this.htmlElement.scrollIntoViewIfNeeded(!0)},a.disable=function(){l(this,L)[L].forEach(function(t){return t.disable()})},o}(k),L=a("cells"),C=function(){function t(t){Object.defineProperty(this,N,{writable:!0,value:void 0}),l(this,N)[N]=t}return e(t,[{key:"symbol",get:function(){return l(this,N)[N]}}]),t}(),N=a("symbol"),T=function(){function t(){var t=this;Object.defineProperty(this,S,{writable:!0,value:Array.from({length:9},function(e,n){return new F(n,t)})}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:[new C("❌"),new C("⭕")]}),Object.defineProperty(this,B,{writable:!0,value:l(this,W)[W][0]})}var n=t.prototype;return n.makeMove=function(t){l(this,I)[I]?l(this,I)[I].disable():(l(this,I)[I]=l(this,S)[S].find(function(e){return e.has(t)}),l(this,S)[S].forEach(function(t){return t.disable()})),l(this,I)[I].makeMove(l(this,B)[B],t),this.checkForWinner()||(l(this,B)[B]=l(this,W)[W][(l(this,W)[W].indexOf(l(this,B)[B])+1)%l(this,W)[W].length],l(this,I)[I]=l(this,S)[S][t.id],l(this,I)[I].enable())},n.checkForWinner=function(){var e=d(l(this,S)[S],l(this,I)[I].id,l(this,B)[B]);if(e){for(var n,r=i(e);!(n=r()).done;){var o=n.value,a=l(this,S)[S][o],s=a.htmlElement.getBoundingClientRect(),c=w(9,200,s.height/1e3);c.style.top=s.top-s.height/6+"px",c.style.left=s.left+"px",document.body.append(c),a.setWinningFlag()}return t.showDialog(l(this,B)[B]).append(w(20,150)),!1}},t.startNewGame=function(){for(var e=new t,n=document.querySelector("main");n.firstChild;)n.removeChild(n.firstChild);n.append(e.htmlElement)},t.showDialog=function(e){if(this.dialogElement)this.dialogElement.winnerSymbol=e.symbol;else{var n=document.createElement("dialog"),r=document.createElement("h2");n.winnerSymbol=document.createTextNode(e.symbol),r.append(n.winnerSymbol," wins!");var i=document.createElement("form");i.method="dialog";var o=document.createElement("input");o.type="submit",o.value="New Game",i.append(o),i.addEventListener("submit",t.startNewGame),n.append(r,i),document.body.append(n),this.dialogElement=n}return this.dialogElement.showModal(),this.dialogElement},e(t,[{key:"htmlElement",get:function(){var t=document.createDocumentFragment();return t.append.apply(t,l(this,S)[S].map(function(t){return t.htmlElement})),t}}]),t}(),S=a("grids"),I=a("currentGrid"),W=a("players"),B=a("currentPlayer");T.startNewGame(),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./"}).then(function(){var t=document.createElement("div"),e=function(){return t.remove()};t.style.position="fixed",t.style.bottom="1rem",t.style.right="50vw",t.style.transform="translateX(50%)",t.style.backgroundColor="#888A",t.style.color="#fff",t.style.padding="1rem",t.style.borderRadius="3px",t.style.cursor="pointer",t.textContent="Ready to work offline",t.addEventListener("click",e),setTimeout(e,2999),document.body.append(t)}).catch(function(t){console.warn(t)})}();
//# sourceMappingURL=tic-tac-toe-ception.js.map
