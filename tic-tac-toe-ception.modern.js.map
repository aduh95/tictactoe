{"version":3,"file":"tic-tac-toe-ception.modern.js","sources":["../src/tictactoeWinning.js","../src/Vector2D.js","../src/fireworks.js","../src/Cell.js","../src/Grid.js","../src/Player.js","../src/Game.js","../src/index.js"],"sourcesContent":["function isHorizontalWin(cells, cellId, player) {\n  const startId = ((cellId / 3) | 0) * 3;\n  const ids = [];\n  for (let i = 0; i < 3; i++) {\n    if (!cells[startId + i].isOwnedBy(player)) return false;\n    ids.push(startId + i);\n  }\n  return ids;\n}\n\nfunction isVerticalWin(cells, cellId, player) {\n  const startId = cellId % 3;\n  const ids = [];\n  for (let i = 0; i < 3; i++) {\n    if (!cells[startId + i * 3].isOwnedBy(player)) return false;\n    ids.push(startId + i * 3);\n  }\n  return ids;\n}\n\nfunction isDiagonalWin(cells, cellId, player) {\n  if (cellId % 1) return false; // if cellId not on diagonal\n  return isDiagonalWin1(...arguments) || isDiagonalWin2(...arguments);\n}\nfunction isDiagonalWin1(cells, cellId, player) {\n  if (cellId % 4 === 2) return false;\n  const ids = [];\n  for (let i = 0; i < 3; i++) {\n    if (!cells[i * 4].isOwnedBy(player)) return false;\n    ids.push(i * 4);\n  }\n  return ids;\n}\nfunction isDiagonalWin2(cells, cellId, player) {\n  if (cellId % 8 === 0) return false;\n  const ids = [];\n  for (let i = 1; i < 4; i++) {\n    if (!cells[i * 2].isOwnedBy(player)) return false;\n    ids.push(i * 2);\n  }\n  return ids;\n}\n\nexport default function makeAMove(cells, cellId, player) {\n  return (\n    isVerticalWin(...arguments) ||\n    isHorizontalWin(...arguments) ||\n    isDiagonalWin(...arguments)\n  );\n}\n","/*\n\nSimple 2D JavaScript Vector Class\n\nHacked from evanw's lightgl.js\nhttps://github.com/evanw/lightgl.js/blob/master/src/vector.js\n\n*/\n\nfunction Vector(x, y) {\n  this.x = x || 0;\n  this.y = y || 0;\n}\n\n/* INSTANCE METHODS */\n\nVector.prototype = {\n  add(...vectors) {\n    for (const v of vectors) {\n      this.x += v.x;\n      this.y += v.y;\n    }\n  },\n\n  multiply(v) {\n    if (typeof v !== \"number\") {\n      this.x *= v.x;\n      this.y *= v.y;\n    } else {\n      this.x *= v;\n      this.y *= v;\n    }\n    return this;\n  },\n  divide(v) {\n    if (typeof v !== \"number\") {\n      if (v.x != 0) this.x /= v.x;\n      if (v.y != 0) this.y /= v.y;\n    } else {\n      if (v != 0) {\n        this.x /= v;\n        this.y /= v;\n      }\n    }\n    return this;\n  },\n  equals(v) {\n    return this.x == v.x && this.y == v.y;\n  },\n  dot(v) {\n    return this.x * v.x + this.y * v.y;\n  },\n  cross(v) {\n    return this.x * v.y - this.y * v.x;\n  },\n  get length() {\n    return Math.sqrt(this.dot(this));\n  },\n  normalize() {\n    return this.divide(this.length);\n  },\n\n  clone() {\n    return new Vector(this.x, this.y);\n  },\n};\n\n/* STATIC */\nVector.NUL = Object.freeze({\n  x: 0,\n  y: 0,\n  clone() {\n    return new Vector();\n  },\n});\n\nexport default Vector;\n","import Vector from \"./Vector2D.js\";\n\nconst colors = [\n  \"#b3312c\",\n  \"#eb8844\",\n  \"#decf2a\",\n  \"#41cd34\",\n  \"#3b511a\",\n  \"#6689d3\",\n  \"#287697\",\n  \"#253192\",\n  \"#7b2fbe\",\n  \"#c354cd\",\n  \"#d88198\",\n  \"#f0f0f0\",\n  \"#ababab\",\n  \"#434343\",\n  \"#1e1b1b\",\n  \"#51301a\",\n];\n\nconst GRAVITY = new Vector(0, -0.981);\nfunction* trackObjectPosition(properties) {\n  const acceleration = properties.initialAcceleration.clone();\n  const velocity = properties.initialVelocity.clone();\n  const position = properties.initialPosition.clone();\n  yield position;\n  for (let i = 0; i < properties.lifeExpectancy; i++) {\n    const thrust =\n      i < properties.fuelAutonomy\n        ? velocity\n            .clone()\n            .normalize()\n            .multiply(properties.motorThrust * (1 - Math.exp(-i)))\n        : Vector.NUL;\n    const friction = velocity.clone().multiply(-properties.frictionCoefficient);\n    acceleration.add(GRAVITY, thrust, friction);\n    velocity.add(acceleration);\n    position.add(velocity);\n    yield position;\n  }\n  return { position, velocity, acceleration };\n}\n\nasync function drawTrajectory(ctx, ballisticObject) {\n  return new Promise((resolve) => {\n    const getPosition = trackObjectPosition(ballisticObject);\n\n    let previousTimestamp;\n    function nextFrame(timestamp) {\n      for (let i = previousTimestamp || timestamp; i < timestamp; i++) {\n        const { value: position, done } = getPosition.next();\n        if (done) return resolve(position);\n        ctx.fillStyle = ballisticObject.color;\n        ctx.beginPath();\n        ctx.rect(\n          position.x >> 20,\n          position.y >> 20,\n          ballisticObject.thickness,\n          1\n        );\n        ctx.fill();\n      }\n      requestAnimationFrame(nextFrame);\n      previousTimestamp = timestamp;\n    }\n    requestAnimationFrame(nextFrame);\n  });\n}\n\nfunction spiderEffect({ position: initialPosition, velocity }, color) {\n  return {\n    initialPosition,\n    initialVelocity: new Vector(0, velocity.y),\n    initialAcceleration: new Vector(\n      (Math.random() - 0.5) * 2000,\n      -GRAVITY.y * 1000\n    ),\n    lifeExpectancy: 800,\n    fuelAutonomy: 0,\n    motorThrust: 0,\n    frictionCoefficient: Math.random() * 0.000015 + 0.000005,\n    thickness: 3,\n    color,\n  };\n}\n\nexport function launchRocket(\n  ctx,\n  initialPosition = Vector.NUL,\n  color = undefined\n) {\n  const skyRocket = {\n    initialPosition,\n    initialVelocity: Vector.NUL,\n    initialAcceleration: new Vector(\n      ((Math.random() + 1.5) % 2) - 1, // [-1, -.5]U[.5, 1]\n      GRAVITY.y * -7\n    ),\n    lifeExpectancy: 900 + Math.random() * 300,\n    fuelAutonomy: 600,\n    motorThrust: GRAVITY.y * -5,\n    frictionCoefficient: Math.random() * 0.000015 + 0.000005,\n    thickness: 7,\n    color: color || colors[(Math.random() * colors.length) | 0],\n  };\n\n  return drawTrajectory(ctx, skyRocket)\n    .then((previousState) =>\n      Promise.all(\n        Array.from({ length: Math.random() * 10 }, () =>\n          drawTrajectory(ctx, spiderEffect(previousState, skyRocket.color))\n        )\n      )\n    )\n    .catch(console.error);\n}\n\n/**\n * @param {HTMLCanvasElement} canvas\n * @param {Promise<>} promiseToWaitFor Promise that resolves when it's time to\n *                                     fade out the canvas (usually a\n *                                     `Promise.all` to wait for all\n *                                     `launchRocket` animations to complete.\n * @param {CanvasRenderingContext2D} ctx\n * @returns {FrameRequestCallback} Frame by frame callback that erases previous\n *                                 traces.\n */\nexport function fadeOutChemTrails(canvas, promiseToWaitFor, ctx = null) {\n  const { width, height } = canvas;\n\n  if (ctx == null) {\n    ctx = canvas.getContext(\"2d\");\n  }\n\n  let previousTimestamp, animationFrameID;\n  function nextFrame(timestamp) {\n    const frame = ctx.getImageData(0, 0, width, height);\n    const speed = (timestamp - previousTimestamp) / 16;\n    for (let i = 3; i < frame.data.length; i += 4) {\n      const val = frame.data[i];\n      if (val > 16) {\n        frame.data[i] = val - (val >> 3) * speed;\n      }\n    }\n    ctx.putImageData(frame, 0, 0);\n\n    animationFrameID = requestAnimationFrame(nextFrame);\n    previousTimestamp = timestamp;\n  }\n\n  promiseToWaitFor.then(() => {\n    canvas.addEventListener(\"transitionend\", () => {\n      cancelAnimationFrame(animationFrameID);\n      canvas.remove();\n    });\n    canvas.style.transformOrigin = \"top\";\n    canvas.style.transition = \"all 3s ease-in\";\n    canvas.style.transitionProperty = \"opacity,transform\";\n    canvas.style.opacity = 0;\n    canvas.style.transform = \"scaleY(1.5)\";\n  });\n\n  return nextFrame;\n}\n\nconst delay = (delay) => new Promise((done) => setTimeout(done, delay));\n\n/**\n * @param {number} numberOfRockets\n * @param {number} delayBetweenRockets in milliseconds\n * @param {number} scale Canvas default size is 1000x1000 px²\n * @returns {HTMLCanvasElement}\n */\nexport default function autoShow(\n  numberOfRockets = 5,\n  delayBetweenRockets = 200,\n  scale = 1\n) {\n  const WIDTH = 1000 * scale;\n  const HEIGHT = 1000 * scale;\n  const canvas = document.createElement(\"canvas\");\n  canvas.height = HEIGHT;\n  canvas.width = WIDTH;\n  const ctx = canvas.getContext(\"2d\");\n  ctx.setTransform(scale, 0, 0, -scale, WIDTH / 2, HEIGHT);\n  requestAnimationFrame(\n    fadeOutChemTrails(\n      canvas,\n      Promise.all(\n        Array.from({ length: numberOfRockets }, (_, i) =>\n          delay(Math.random() * 50 + i * delayBetweenRockets).then(() =>\n            launchRocket(ctx)\n          )\n        )\n      ),\n      ctx\n    )\n  );\n\n  return canvas;\n}\n","const cellInstances = new WeakMap();\n\nfunction onclick(event) {\n  cellInstances.get(event.target).makeMove();\n}\n\nexport default class Cell {\n  #id;\n  #owner;\n  #game;\n  #htmlElement = this.createHTMLElement();\n\n  constructor(id, game) {\n    this.#id = id;\n    this.#game = game;\n  }\n\n  createHTMLElement() {\n    const button = document.createElement(\"button\");\n    button.addEventListener(\"click\", onclick);\n    button.className = \"cell\";\n    button.setAttribute(\"aria-label\", \"Empty cell\");\n    cellInstances.set(button, this);\n    return button;\n  }\n\n  makeMove() {\n    this.#game.makeMove(this);\n  }\n\n  get htmlElement() {\n    return this.#htmlElement;\n  }\n\n  isOwnedBy(player) {\n    return this.#owner === player;\n  }\n\n  setFoot(player) {\n    this.#owner = player;\n    this.htmlElement.removeAttribute(\"aria-label\");\n    this.htmlElement.dataset.player = player.symbol;\n  }\n\n  setWinningFlag() {\n    this.htmlElement.classList.add(\"win\");\n  }\n\n  isEmpty() {\n    return !this.#owner;\n  }\n\n  get id() {\n    return this.#id;\n  }\n\n  enable() {\n    this.htmlElement.disabled = false;\n  }\n  disable() {\n    this.htmlElement.disabled = true;\n  }\n}\n","import Cell from \"./Cell.js\";\nimport getTicTacToeWinner from \"./tictactoeWinning.js\";\nimport launchFireworks from \"./fireworks.js\";\n\nexport default class Grid extends Cell {\n  #cells;\n\n  constructor(id, game) {\n    super(id);\n    this.#cells = Array.from({ length: 9 }, (_, i) => new Cell(i, game));\n    this.htmlElement.append(...this.#cells.map((cell) => cell.htmlElement));\n  }\n\n  createHTMLElement() {\n    const div = document.createElement(\"div\");\n    div.className = \"tic-tac-toe\";\n    return div;\n  }\n\n  has(cell) {\n    return this.#cells.includes(cell);\n  }\n\n  isLegal(cell) {\n    return (\n      this.has(cell) &&\n      (cell.isEmpty() || this.#cells.every((cell) => !cell.isEmpty()))\n    );\n  }\n\n  makeMove(player, cell) {\n    if (!this.isLegal(cell)) {\n      throw new Error(\"Illegal move\");\n    }\n    if (cell.isEmpty()) {\n      cell.setFoot(player);\n      this.checkForWinner(player, cell);\n    }\n  }\n\n  checkForWinner(player, cell) {\n    if (!this.isEmpty()) return;\n    const winningCells = getTicTacToeWinner(this.#cells, cell.id, player);\n    if (winningCells) {\n      const boundingRect = this.htmlElement.getBoundingClientRect();\n      const canvas = launchFireworks(9, 200, boundingRect.height / 1000);\n      for (const cellId of winningCells) {\n        this.#cells[cellId].setWinningFlag();\n      }\n      this.setFoot(player);\n      canvas.style.top = boundingRect.top - boundingRect.height / 6 + \"px\";\n      canvas.style.left = boundingRect.left + \"px\";\n      document.body.append(canvas);\n    }\n  }\n\n  /**\n   * Enables empty cells\n   * When there are no empty cells, all cells are enabled.\n   */\n  enable() {\n    const lonelyCells = this.#cells.filter((cell) => cell.isEmpty());\n    (lonelyCells.length ? lonelyCells : this.#cells).forEach((cell) =>\n      cell.enable()\n    );\n  }\n  disable() {\n    this.#cells.forEach((cell) => cell.disable());\n  }\n}\n","export default class Player {\n  #symbol;\n\n  constructor(symbol) {\n    this.#symbol = symbol;\n  }\n\n  get symbol() {\n    return this.#symbol;\n  }\n}\n","import getTicTacToeWinner from \"./tictactoeWinning.js\";\nimport launchFireworks from \"./fireworks.js\";\nimport Grid from \"./Grid.js\";\nimport Player from \"./Player.js\";\n\nexport default class Game {\n  #grids = Array.from({ length: 9 }, (_, i) => new Grid(i, this));\n  #currentGrid;\n  #players = [new Player(\"❌\"), new Player(\"⭕\")];\n  #currentPlayer = this.#players[0];\n\n  makeMove(cell) {\n    if (!this.#currentGrid) {\n      this.#currentGrid = this.#grids.find((grid) => grid.has(cell));\n      this.#grids.forEach((grid) => grid.disable());\n    } else {\n      this.#currentGrid.disable();\n    }\n    this.#currentGrid.makeMove(this.#currentPlayer, cell);\n    if (!this.checkForWinner()) {\n      this.#currentPlayer = this.#players[\n        (this.#players.indexOf(this.#currentPlayer) + 1) % this.#players.length\n      ];\n      this.#currentGrid = this.#grids[cell.id];\n      this.#currentGrid.enable();\n    }\n  }\n\n  checkForWinner() {\n    const winningGrids = getTicTacToeWinner(\n      this.#grids,\n      this.#currentGrid.id,\n      this.#currentPlayer\n    );\n    if (winningGrids) {\n      for (const gridId of winningGrids) {\n        const grid = this.#grids[gridId];\n        const boundingRect = grid.htmlElement.getBoundingClientRect();\n        const canvas = launchFireworks(9, 200, boundingRect.height / 1000);\n        canvas.style.top = boundingRect.top - boundingRect.height / 6 + \"px\";\n        canvas.style.left = boundingRect.left + \"px\";\n        document.body.append(canvas);\n        grid.setWinningFlag();\n      }\n\n      Game.showDialog(this.#currentPlayer).append(launchFireworks(20, 150));\n\n      return false;\n    }\n  }\n\n  get htmlElement() {\n    const frag = document.createDocumentFragment();\n    frag.append(...this.#grids.map((grid) => grid.htmlElement));\n    return frag;\n  }\n\n  static startNewGame() {\n    const newGame = new Game();\n    const main = document.querySelector(\"main\");\n    while (main.firstChild) main.removeChild(main.firstChild);\n    main.append(newGame.htmlElement);\n  }\n\n  static showDialog(player) {\n    if (!this.dialogElement) {\n      const celebrateWinnerBanner = document.createElement(\"dialog\");\n      const h2 = document.createElement(\"h2\");\n      celebrateWinnerBanner.winnerSymbol = document.createTextNode(\n        player.symbol\n      );\n      h2.append(celebrateWinnerBanner.winnerSymbol, \" wins!\");\n      const form = document.createElement(\"form\");\n      form.method = \"dialog\";\n      const button = document.createElement(\"input\");\n      button.type = \"submit\";\n      button.value = \"New Game\";\n      form.append(button);\n\n      form.addEventListener(\"submit\", Game.startNewGame);\n      celebrateWinnerBanner.append(h2, form);\n      document.body.append(celebrateWinnerBanner);\n      this.dialogElement = celebrateWinnerBanner;\n    } else {\n      this.dialogElement.winnerSymbol = player.symbol;\n    }\n    this.dialogElement.showModal();\n    return this.dialogElement;\n  }\n}\n","import Game from \"./Game.js\";\n\nGame.startNewGame();\n\nif (typeof PRODUCTION_ENV !== \"undefined\") {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker\n      .register(\"./sw.js\", { scope: \"./\" })\n      .then(() => {\n        const div = document.createElement(\"div\");\n        const remove = () => div.remove();\n        div.style.position = \"fixed\";\n        div.style.bottom = \"1rem\";\n        div.style.right = \"50vw\";\n        div.style.transform = \"translateX(50%)\";\n        div.style.backgroundColor = \"#888A\";\n        div.style.color = \"#fff\";\n        div.style.padding = \"1rem\";\n        div.style.borderRadius = \"3px\";\n        div.style.cursor = \"pointer\";\n        div.textContent = \"Ready to work offline\";\n        div.addEventListener(\"click\", remove);\n        setTimeout(remove, 2999);\n        document.body.append(div);\n      })\n      .catch((error) => {\n        // registration failed\n        console.warn(error);\n      });\n  }\n}\n"],"names":["isHorizontalWin","cells","cellId","player","startId","ids","i","isOwnedBy","push","isVerticalWin","isDiagonalWin","isDiagonalWin1","arguments","isDiagonalWin2","makeAMove","Vector","x","y","this","prototype","add","vectors","v","multiply","divide","equals","dot","cross","length","Math","sqrt","normalize","clone","NUL","Object","freeze","colors","GRAVITY","async","drawTrajectory","ctx","ballisticObject","Promise","resolve","getPosition","properties","acceleration","initialAcceleration","velocity","initialVelocity","position","initialPosition","lifeExpectancy","thrust","fuelAutonomy","motorThrust","exp","friction","frictionCoefficient","trackObjectPosition","previousTimestamp","requestAnimationFrame","nextFrame","timestamp","value","done","next","fillStyle","color","beginPath","rect","thickness","fill","autoShow","numberOfRockets","delayBetweenRockets","scale","WIDTH","HEIGHT","canvas","document","createElement","height","width","getContext","setTransform","promiseToWaitFor","animationFrameID","then","addEventListener","cancelAnimationFrame","remove","style","transformOrigin","transition","transitionProperty","opacity","transform","frame","getImageData","speed","data","val","putImageData","fadeOutChemTrails","all","Array","from","_","delay","random","setTimeout","skyRocket","previousState","spiderEffect","catch","console","error","launchRocket","cellInstances","WeakMap","onclick","event","get","target","makeMove","Cell","constructor","id","game","createHTMLElement","_classPrivateFieldLooseBase","button","className","setAttribute","set","htmlElement","setFoot","removeAttribute","dataset","symbol","setWinningFlag","classList","isEmpty","enable","disabled","disable","Grid","super","append","map","cell","div","has","includes","isLegal","every","Error","checkForWinner","winningCells","getTicTacToeWinner","boundingRect","getBoundingClientRect","launchFireworks","top","left","body","lonelyCells","filter","forEach","Player","Game","find","grid","indexOf","winningGrids","gridId","showDialog","frag","createDocumentFragment","[object Object]","newGame","main","querySelector","firstChild","removeChild","dialogElement","winnerSymbol","celebrateWinnerBanner","h2","createTextNode","form","method","type","startNewGame","showModal","navigator","serviceWorker","register","scope","bottom","right","backgroundColor","padding","borderRadius","cursor","textContent","warn"],"mappings":"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"}